<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Mus√©e salon</title>
    <link rel="stylesheet" href="static/bootstrap3/css/bootstrap.min.css">
  </head>
  <body>
    <div class=" text-center">
      <div class="row" style="background:black">
        <img src="" alt="" id="img"
        style="height:80vh;">
      </div>
      <div class="">
        <h1 id="name"></h1>
        <h2 id="author"></h2>
      </div>
      <div class="row">
        <button onclick="previous()" class="btn btn-default btn-sm"><<</button>
        <button onclick="pause()" id="pause" class="btn btn-default btn-sm">pause</button>
        <button onclick="play()" id="play" class="btn btn-default btn-sm">play</button>
        <button onclick="next()" class="btn btn-default btn-sm">>></button>
      </div>
      <div class="row">
        Change every
        <input type="number" value="10" style="width:35px" id="timeoutInterval">
        second
      </div>
      <div class="">
        Fetching among a total of {{numberOfArtworks}} artworks.
      </div>
    </div>
    <script src="static/jquery/jquery.min.js" charset="utf-8"></script>
    <script type="text/javascript">
      var $img = null;
      var $name = null;
      var $author = null;
      var $timeoutInterval = null;
      var $pause = null;
      var $play = null;
      var previousId = null;
      var nextId = null;
      var timeoutId = null;
      function previous(){
        setArtworkForId(0); // todo, but how??
      }
      function pause(){
        $pause.hide();
        $play.show();
        clearTimeout(timeoutId);
      }
      function play(){
        $play.hide();
        $pause.show();
        next();
      }
      function next(){
        console.log('next() called');
        $.get('/next', null, function(artwork){
          console.log(artwork);
          setArtwork(artwork);
        });
        clearTimeout(timeoutId);
        timeoutInterval = parseInt($timeoutInterval.val());
        if(timeoutInterval <= 0){
          timeoutInterval = 10;
        }
        console.log('next() using timeoutInterval='+timeoutInterval);
        timeoutId = setTimeout(function(){
          console.log('setTimeout() called');
          next();
        }, timeoutInterval*1000);
        console.log('next() timeoutId='+timeoutId);
      }
      function setArtwork(a) {
        $img.attr('src', a.url);
        $name.html(a.name);
        $author.html(a.author);
      }
      $(function(){
        $img = $('#img');
        $name = $('#name');
        $author = $('#author');
        $timeoutInterval = $('#timeoutInterval');
        $pause = $('#pause');
        $play = $('#play');
        play();
      });
    </script>
  </body>
</html>
